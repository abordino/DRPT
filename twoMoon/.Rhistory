if (is.null(size)) {
h = image_info(img)$height
size = max(18, round(h * 0.05))
}
image_annotate(
img, lab,
gravity  = corner,                 # "northwest" = top-left
location = paste0("+", inset, "+", inset),
size     = size,
weight   = 700,
color    = "black",
boxcolor = "rgba(255,255,255,0.7)"
)
}
# Label each image (ensure each element is a magick-image)
labeled = lapply(seq_along(labels), function(i) {
label_img(imgs_eqh[i], labels[i])
})
# Combine pictures with simple text labels
library(magick)
imgs = image_read(c("experiments/pictures/BIVsimul_shiftedMMD.png",
"experiments/pictures/binary.png",
"experiments/pictures/DRPT_excessGaussian.png"))
# Add (a), (b), (c) in the top-left corner of each image
a = image_annotate(imgs[1], "(a)", size = 30, color = "black",
boxcolor = "white", gravity = "northwest",
location = "+15+15")
setwd("~/Documents/phd/projects/DRPT/code/simulationCpp/synthetic/experiments")
# Combine pictures with simple text labels
library(magick)
imgs = image_read(c("experiments/pictures/BIVsimul_shiftedMMD.png",
"experiments/pictures/binary.png",
"experiments/pictures/DRPT_excessGaussian.png"))
imgs = image_read(c("experiments/pictures/BIVsimul_shiftedMMD.png",
"experiments/pictures/binary.png",
"experiments/pictures/DRPT_excessGaussian.png"))
# Combine pictures with simple text labels
library(magick)
imgs = image_read(c("experiments/pictures/BIVsimul_shiftedMMD.png",
"experiments/pictures/binary.png",
"experiments/pictures/DRPT_excessGaussian.png"))
rm(list = ls())  # Clear environment
gc()             # Free memory
# setwd("~/Documents/phd/distr_shift/simulationCpp/synthetic")
setwd("~/Documents/phd/projects/DRPT/code/simulationCpp/synthetic/")
library(MASS)
library(latex2exp)
library(squash)
library(DRPT)
library(kerTests)
set.seed(110932)
# Combine pictures with simple text labels
library(magick)
imgs = image_read(c("experiments/pictures/BIVsimul_shiftedMMD.png",
"experiments/pictures/binary.png",
"experiments/pictures/DRPT_excessGaussian.png"))
# Add (a), (b), (c) in the top-left corner of each image
a = image_annotate(imgs[1], "(a)", size = 30, color = "black",
boxcolor = "white", gravity = "northwest",
location = "+15+15")
# Combine pictures with simple (a)/(b)/(c) labels using only image_annotate()
library(magick)
imgs <- image_read(c(
"experiments/pictures/BIVsimul_shiftedMMD.png",
"experiments/pictures/binary.png",
"experiments/pictures/DRPT_excessGaussian.png"
))
# Arm64-safe annotate: explicit font, no boxcolor, no weight/style
# (Default gravity behaves like top-left; we just give a small offset)
annotate_safe <- function(img, label, px = "+15+20") {
# Try a couple of common fonts in case one isn’t available
for (f in c("DejaVu Sans", "Arial", "Helvetica", "")) {
res <- try(
image_annotate(img, label, size = 30, color = "black",
font = f, location = px),
silent = TRUE
)
if (!inherits(res, "try-error")) return(res)
}
stop("image_annotate failed for label: ", label)
}
a <- annotate_safe(imgs[1], "(a)")
b <- annotate_safe(imgs[2], "(b)")
c <- annotate_safe(imgs[3], "(c)")
# Combine pictures with simple (a)/(b)/(c) labels using only image_annotate()
library(magick)
imgs = image_read(c(
"experiments/pictures/BIVsimul_shiftedMMD.png",
"experiments/pictures/binary.png",
"experiments/pictures/DRPT_excessGaussian.png"
))
# Arm64-safe annotate: explicit font, no boxcolor, no weight/style
# (Default gravity behaves like top-left; we just give a small offset)
annotate_safe = function(img, label, px = "+15+20") {
# Try a couple of common fonts in case one isn’t available
for (f in c("DejaVu Sans", "Arial", "Helvetica", "")) {
res = try(
image_annotate(img, label, size = 30, color = "black",
font = f, location = px),
silent = TRUE
)
if (!inherits(res, "try-error")) return(res)
}
stop("image_annotate failed for label: ", label)
}
a = annotate_safe(imgs[1], "(a)")
b = annotate_safe(imgs[2], "(b)")
c = annotate_safe(imgs[3], "(c)")
rm(list = ls())  # Clear environment
gc()             # Free memory
# setwd("~/Documents/phd/distr_shift/simulationCpp/synthetic")
setwd("~/Documents/phd/projects/DRPT/code/simulationCpp/synthetic/")
library(MASS)
library(latex2exp)
library(squash)
library(DRPT)
library(kerTests)
set.seed(110932)
# Combine pictures with simple (a)/(b)/(c) labels using only image_annotate()
library(magick)
imgs = image_read(c(
"experiments/pictures/BIVsimul_shiftedMMD.png",
"experiments/pictures/binary.png",
"experiments/pictures/DRPT_excessGaussian.png"
))
# Arm64-safe annotate: explicit font, no boxcolor, no weight/style
# (Default gravity behaves like top-left; we just give a small offset)
annotate_safe = function(img, label, px = "+15+20") {
# Try a couple of common fonts in case one isn’t available
for (f in c("DejaVu Sans", "Arial", "Helvetica", "")) {
res = try(
image_annotate(img, label, size = 30, color = "black",
font = f, location = px),
silent = TRUE
)
if (!inherits(res, "try-error")) return(res)
}
stop("image_annotate failed for label: ", label)
}
a = annotate_safe(imgs[1], "(a)")
b = annotate_safe(imgs[2], "(b)")
c = annotate_safe(imgs[3], "(c)")
# Combine pictures with simple text labels
library(magick)
imgs = image_read(c("experiments/pictures/BIVsimul_shiftedMMD.png",
"experiments/pictures/binary.png",
"experiments/pictures/DRPT_excessGaussian.png"))
imgs
imgs[1]
# Combine pictures with simple text labels
library(magick)
imgs = image_read(c("experiments/pictures/BIVsimul_shiftedMMD.png",
"experiments/pictures/binary.png",
"experiments/pictures/DRPT_excessGaussian.png"))
# Add (a), (b), (c) in the top-left corner of each image
a = image_annotate(imgs[1], "(a)", size = 30, color = "black",
gravity = "northwest")
# Label three images and append them horizontally (magick)
library(magick)
# Read images (as in the R CHARTS examples)
imgs <- image_read(c(
"experiments/pictures/BIVsimul_shiftedMMD.png",
"experiments/pictures/binary.png",
"experiments/pictures/DRPT_excessGaussian.png"
))
# Add (a), (b), (c) in the top-left corner of each image
a <- image_annotate(imgs[1], "(a)", size = 30, color = "black",
gravity = "northwest", location = "+15+15")
# Label three images and append them horizontally (magick)
library(magick)
# Read images (as in the R CHARTS examples)
imgs <- image_read(c(
"experiments/pictures/BIVsimul_shiftedMMD.png",
"experiments/pictures/binary.png",
"experiments/pictures/DRPT_excessGaussian.png"
))
# Add (a), (b), (c) in the top-left corner of each image
a <- image_annotate(imgs[1], "(a)", size = 30, color = "black",
gravity = "northwest", location = "+15+15", font = "DejaVu Sans")
# Label three images and combine them horizontally (arm64-safe)
library(magick)
files <- c(
"experiments/pictures/BIVsimul_shiftedMMD.png",
"experiments/pictures/binary.png",
"experiments/pictures/DRPT_excessGaussian.png"
)
imgs <- image_read(files)
# Add a top-left label using base R drawing (avoids annotate bug)
label_draw <- function(img, lab, x = 15, y = 35) {
h <- image_info(img)$height
cex_val <- max(1, h / 400)  # scales roughly to ~30px at ~1200px height
canvas <- image_draw(img)
# optional soft white box for readability
rect(x - 6, y - 26, x + 60, y + 6, col = rgb(1, 1, 1, 0.7), border = NA)
text(x, y, labels = lab, cex = cex_val, col = "black", adj = c(0, 1))
dev.off()
}
a <- label_draw(imgs[1], "(a)")
b <- label_draw(imgs[2], "(b)")
c <- label_draw(imgs[3], "(c)")
# Label three images (a)/(b)/(c) using Hershey fonts and combine horizontally
library(magick)
files <- c(
"experiments/pictures/BIVsimul_shiftedMMD.png",
"experiments/pictures/binary.png",
"experiments/pictures/DRPT_excessGaussian.png"
)
imgs <- image_read(files)
label_draw <- function(img, lab, x = 15, y = 35) {
info <- image_info(img)
h <- info$height
cex_val <- max(1, h / 400)  # ~30px at ~1200px tall images
canvas <- image_draw(img)
par(mar = c(0,0,0,0), xpd = NA, family = "HersheySans")
# background box for readability
w  <- strwidth(lab, cex = cex_val)
ht <- strheight(lab, cex = cex_val)
rect(x - 6, y - 1.6*ht, x + 6 + 1.1*w, y + 6,
col = rgb(1,1,1,0.7), border = NA)
# place text, anchored top-left
text(x, y, labels = lab, cex = cex_val, col = "black", adj = c(0, 1))
dev.off()
}
a <- label_draw(imgs[1], "(a)")
b <- label_draw(imgs[2], "(b)")
c <- label_draw(imgs[3], "(c)")
combo <- image_append(c(a, b, c), stack = FALSE)
library(magick)
files <- c(
"experiments/pictures/BIVsimul_shiftedMMD.png",
"experiments/pictures/binary.png",
"experiments/pictures/DRPT_excessGaussian.png"
)
imgs <- image_read(files)
# Draw (a)/(b)/(c) in the top-left using Hershey fonts (avoids FreeType issues)
label_draw <- function(img, lab, x = 15, y = 35) {
info <- image_info(img)
h <- info$height
cex_val <- max(1, h / 400)  # ~30px at ~1200px height
img <- image_draw(img)  # IMPORTANT: reassign to img and return it later
par(mar = c(0,0,0,0), xpd = NA, family = "HersheySans")
# soft white box behind text
w  <- strwidth(lab, cex = cex_val)
ht <- strheight(lab, cex = cex_val)
rect(x - 6, y - 1.6*ht, x + 6 + 1.1*w, y + 6,
col = rgb(1,1,1,0.7), border = NA)
text(x, y, labels = lab, cex = cex_val, col = "black", adj = c(0, 1))
dev.off()
img  # return the magick image
}
a <- label_draw(imgs[1], "(a)")
b <- label_draw(imgs[2], "(b)")
c <- label_draw(imgs[3], "(c)")
# Combine horizontally
combo <- image_append(image_join(a, b, c), stack = FALSE)
image_write(combo, "experiments/pictures/combined_1_labeled.png")
# --------------------------------------
# combine pictures
# --------------------------------------
library(magick)
files = c(
"experiments/pictures/BIVsimul_shiftedMMD.png",
"experiments/pictures/binary.png",
"experiments/pictures/DRPT_excessGaussian.png"
)
imgs = image_read(files)
# Draw (a)/(b)/(c)
label_draw = function(img, lab, x = 15, y = 35) {
info = image_info(img)
h = info$height
cex_val = max(1, h / 400)
img = image_draw(img)
par(mar = c(0,0,0,0), xpd = NA, family = "HersheySans")
# soft white box behind text
w  = strwidth(lab, cex = cex_val)
ht = strheight(lab, cex = cex_val)
rect(x - 6, y - 1.6*ht, x + 6 + 1.1*w, y + 6,
col = rgb(1,1,1,0.7), border = NA)
text(x, y, labels = lab, cex = cex_val, col = "black", adj = c(0, 1))
dev.off()
img
}
a = label_draw(imgs[1], "(a)")
b = label_draw(imgs[2], "(b)")
c = label_draw(imgs[3], "(c)")
# Combine horizontally
combo = image_append(image_join(a, b, c), stack = FALSE)
image_write(combo, "experiments/pictures/combined_1_labeled.png")
# --------------------------------------
# combine pictures
# --------------------------------------
library(magick)
files = c(
"experiments/pictures/BIVsimul_shiftedMMD.png",
"experiments/pictures/binary.png",
"experiments/pictures/DRPT_excessGaussian.png"
)
imgs = image_read(files)
# Bold + thicker label using Hershey (no FreeType) and overpainting
label_draw = function(img, lab, x = 15, y = 35, extra_thick = 1) {
info = image_info(img)
h = info$height
cex_val = max(1, h / 400)          # ~30 px at ~1200 px height
stroke  = max(1, round(h / 1200))  # scale thickness with image size
stroke  = stroke + extra_thick
img = image_draw(img)
par(mar = c(0,0,0,0), xpd = NA, family = "HersheySansBold")
# background box
w  = strwidth(lab, cex = cex_val)
ht = strheight(lab, cex = cex_val)
rect(x - 6, y - 1.6*ht, x + 6 + 1.1*w, y + 6,
col = rgb(1,1,1,0.7), border = NA)
# fake bold: draw around the target point
offs = unique(as.vector(outer(c(-stroke, 0, stroke), c(-stroke, 0, stroke),
paste)))  # 8 neighbors + center
for (o in offs) {
xy = as.numeric(strsplit(o, " ")[[1]])
dx = xy[1]; dy = xy[2]
text(x + dx, y + dy, labels = lab, cex = cex_val, col = "black", adj = c(0,1))
}
# center pass (crisp)
text(x, y, labels = lab, cex = cex_val, col = "black", adj = c(0,1))
dev.off()
img
}
a = label_draw(imgs[1], "(a)", extra_thick = 1)  # increase for thicker
b = label_draw(imgs[2], "(b)", extra_thick = 1)
c = label_draw(imgs[3], "(c)", extra_thick = 1)
library(magick)
files = c(
"experiments/pictures/BIVsimul_shiftedMMD.png",
"experiments/pictures/binary.png",
"experiments/pictures/DRPT_excessGaussian.png"
)
imgs = image_read(files)
# Draw (a)/(b)/(c)
label_draw = function(img, lab, x = 15, y = 35) {
info = image_info(img)
h = info$height
cex_val = max(1, h / 400)
img = image_draw(img)
par(mar = c(0,0,0,0), xpd = NA, family = "HersheySans")
# soft white box behind text
w  = strwidth(lab, cex = cex_val)
ht = strheight(lab, cex = cex_val)
rect(x - 6, y - 1.6*ht, x + 6 + 1.1*w, y + 6,
col = rgb(1,1,1,0.7), border = NA)
text(x, y, labels = lab, cex = cex_val, col = "black", adj = c(0, 1))
dev.off()
img
}
a = label_draw(imgs[1], "(a)")
b = label_draw(imgs[2], "(b)")
c = label_draw(imgs[3], "(c)")
# Combine horizontally
combo = image_append(image_join(a, b, c), stack = FALSE)
image_write(combo, "experiments/pictures/combined_1.png")
# Combine pictures
library(magick)
files = c("pictures/stroop.png",
"pictures/frisk_4curves_wald.png",
"pictures/stroop.png"
)
imgs = image_read(files)
rm(list = ls())  # Clear environment
gc()             # Free memory
setwd("~/Documents/phd/projects/DRPT/code/simulationCpp/frisk")
library(latex2exp)
library(rootSolve)
library(DRPT)
set.seed(120720)
# Combine pictures
library(magick)
files = c("pictures/stroop.png",
"pictures/frisk_4curves_wald.png",
"pictures/stroop.png"
)
imgs = image_read(files)
# Combine pictures
library(magick)
files = c("experiments/pictures/stroop.png",
"experiments/pictures/frisk_4curves_wald.png",
"experiments/pictures/stroop.png"
)
imgs = image_read(files)
# Draw (a)/(b)/(c)
label_draw = function(img, lab, x = 15, y = 35) {
info = image_info(img)
h = info$height
cex_val = max(1, h / 400)
img = image_draw(img)
par(mar = c(0,0,0,0), xpd = NA, family = "HersheySans")
# soft white box behind text
w  = strwidth(lab, cex = cex_val)
ht = strheight(lab, cex = cex_val)
rect(x - 6, y - 1.6*ht, x + 6 + 1.1*w, y + 6,
col = rgb(1,1,1,0.7), border = NA)
text(x, y, labels = lab, cex = cex_val, col = "black", adj = c(0, 1))
dev.off()
img
}
a = label_draw(imgs[1], "(a)")
b = label_draw(imgs[2], "(b)")
c = label_draw(imgs[3], "(c)")
# Combine horizontally
combo = image_append(image_join(a, b, c), stack = FALSE)
image_write(combo, "experiments/pictures/combined_1.png")
# Combine pictures
library(magick)
files = c("experiments/pictures/stroop.png",
"experiments/pictures/frisk_4curves_wald.png",
"experiments/pictures/stroop.png"
)
imgs = image_read(files)
# Draw (a)/(b)/(c)
label_draw = function(img, lab, x = 15, y = 35) {
info = image_info(img)
h = info$height
cex_val = max(1, h / 400)
img = image_draw(img)
par(mar = c(0,0,0,0), xpd = NA, family = "HersheySans")
# soft white box behind text
w  = strwidth(lab, cex = cex_val)
ht = strheight(lab, cex = cex_val)
rect(x - 6, y - 1.6*ht, x + 6 + 1.1*w, y + 6,
col = rgb(1,1,1,0.7), border = NA)
text(x, y, labels = lab, cex = cex_val, col = "black", adj = c(0, 1))
dev.off()
img
}
a = label_draw(imgs[1], "(a)")
b = label_draw(imgs[2], "(b)")
c = label_draw(imgs[3], "(c)")
# Combine horizontally
combo = image_append(image_join(a, b, c), stack = FALSE)
image_write(combo, "experiments/pictures/combined_2.png")
rm(list = ls())  # Clear environment
gc()             # Free memory
setwd("~/Documents/phd/projects/DRPT/code/simulationCpp/twoMoon")
# setwd("/storage/stats/strtng/SPT/twoMoon")
library(MASS)
library(latex2exp)
library(DRPT)
library(kerTests)
library(reticulate)
#--------------------------------------------------------------------
# Combine all figure in one
#--------------------------------------------------------------------
# Combine pictures
library(magick)
files = c("results/drpt_power_vs_budget.png",
"results/roc_curves_weighted.png")
imgs = image_read(files)
# Draw (a)/(b)/(c)
label_draw = function(img, lab, x = 15, y = 35) {
info = image_info(img)
h = info$height
cex_val = max(1, h / 400)
img = image_draw(img)
par(mar = c(0,0,0,0), xpd = NA, family = "HersheySans")
# soft white box behind text
w  = strwidth(lab, cex = cex_val)
ht = strheight(lab, cex = cex_val)
rect(x - 6, y - 1.6*ht, x + 6 + 1.1*w, y + 6,
col = rgb(1,1,1,0.7), border = NA)
text(x, y, labels = lab, cex = cex_val, col = "black", adj = c(0, 1))
dev.off()
img
}
a = label_draw(imgs[1], "(a)")
b = label_draw(imgs[2], "(b)")
c = label_draw(imgs[3], "(c)")
a = label_draw(imgs[1], "(a)")
b = label_draw(imgs[2], "(b)")
# Combine horizontally
combo = image_append(image_join(a, b), stack = FALSE)
image_write(combo, "experiments/pictures/combined_3.png")
a = label_draw(imgs[1], "(a)")
b = label_draw(imgs[2], "(b)")
# Combine horizontally
combo = image_append(image_join(a, b), stack = FALSE)
image_write(combo, "results/combined_3.png")
# Combine pictures
library(magick)
files = c("results/drpt_power_vs_budget.png",
"results/roc_curves_weighted.png")
imgs = image_read(files)
# Pick a target height (use the smaller one to avoid upscaling artifacts)
target_h = min(image_info(imgs)$height)
# Scale each image to that exact height, preserving aspect ratio
imgs = image_scale(imgs, paste0("x", target_h))
# Draw (a)/(b)/(c)
label_draw = function(img, lab, x = 15, y = 35) {
info = image_info(img)
h = info$height
cex_val = max(1, h / 400)
img = image_draw(img)
par(mar = c(0,0,0,0), xpd = NA, family = "HersheySans")
# soft white box behind text
w  = strwidth(lab, cex = cex_val)
ht = strheight(lab, cex = cex_val)
rect(x - 6, y - 1.6*ht, x + 6 + 1.1*w, y + 6,
col = rgb(1,1,1,0.7), border = NA)
text(x, y, labels = lab, cex = cex_val, col = "black", adj = c(0, 1))
dev.off()
img
}
a = label_draw(imgs[1], "(a)")
b = label_draw(imgs[2], "(b)")
# Combine horizontally
combo = image_append(image_join(a, b), stack = FALSE)
image_write(combo, "results/combined_3.png")
